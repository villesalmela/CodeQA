{% extends 'base.html.j2' %}
{% block head %}
{% include 'load_ace.html' %}
{% include 'load_datatables.html' %}
<script src="/static/functions.js"></script>
{% endblock %}
{% block title %}Code QA{% endblock %}
{% block body %}
<h1>Test your function</h1>
<nav class="trail">
    <ul>
        <li><a href="/add">Check</a></li>
        <li><a href="/doc">Document</a></li>
        <li><strong>Test</strong></li>
        <li>Classify</li>
    </ul>
</nav>
<p>Click 'Generate Tests' to have OpenAI automatically generate a set of unit tests for your code.
    You can then review and modify the tests, before running them with 'Run Tests'
</p>
{% include 'error_form.html.j2' %}
{% if error %}
<p class="error-message">{{ error }}</p>
{% endif %}
<form id="form" method="POST" action="/test">
    {{ form.csrf_token }}
    <label for="editor_box_documented">Source Code (Documented)</label><br>
    <div id="editor_box_documented" class="editor-box"></div>
    <input type="hidden" id="documented" name="documented">
    <label for="editor_box_unittests">Unit Tests</label><br>
    <div id="editor_box_unittests" class="editor-box"></div>
    <input type="hidden" id="unittests" name="unittests">
    {% if results %}
    <h2>Test results</h2>
    <pre>
        {{ results }}
    </pre>
    {% endif %}
    {{ form.generate }}
    {{ form.run }}
    {{ form.next }}
</form>
<script nonce="{{ csp_nonce() }}">
    setSpinner("form")
    addEditor("editor_box_documented", {{ form.documented.data | tojson }}, "documented")
    addEditor("editor_box_unittests", {{ form.unittests.data | tojson }}, "unittests")
</script>
{% endblock %}